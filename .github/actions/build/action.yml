name: Build
description: Build slackpkg using Docker image
inputs:
  targets:
    required: true
    description: Targets to build
runs:
  - uses: docker/login-action@v2
    with:
      registry: ghcr.io
      username: ${{ github.actor }}
      password: ${{ secrets.GITHUB_TOKEN }}

  - run: |
      docker pull ghcr.io/erikkugel/slackbuild:0.0.1
      mkdir -v packages

  - uses: ./.github/actions/slackbuild
    with:
      target: ${{ inputs.targets }}

  - uses: actions/upload-artifact@v3
    with:
      name: packages
      path: ./packages/*.txz
